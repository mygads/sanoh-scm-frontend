<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../style.css">
</head>

<body class="font-poppins bg-white">
  <section class="overflow-hidden w-screen h-screen bg-white">
    <main class="flex flex-col w-[80%] mb-[100%] mt-[3%] mx-auto px-6 2xl:px-10">
      <section class="flex flex-col self-stretch py-px my-auto w-full ">
        <header class="flex gap-3 items-center self-start text-2xl font-semibold text-black">
          <a href="delivery-note.html">
            <img loading="lazy" src="../assets/icon_back.svg" alt="" class="object-contain shrink-0 self-stretch my-auto w-5 2xl:w-7 cursor-pointer pointer-events-auto aspect-square" />
          </a>
          <h1 class="self-stretch my-auto text-[80%] 2xl:text-[120%]">Confirm Delivery Note (DN)</h1>
        </header>

        <!-- Table for editing qtyConfirm -->
        <div class="flex flex-col mt-5 2xl:mt-8">
          <div class="relative overflow-x-auto shadow-md rounded-lg border border-gray-300">
            <table class="w-full text-[11px] 2xl:text-base text-left text-gray-700">
              <thead class="text-[14px] 2xl:text-[20px] text-gray-700">
                <tr>
                  <!-- Table Headers -->
                  <th class="px-2 2xl:py-4 py-3 text-center border-b border-b-gray-400">No</th>
                  <th class="px-2 2xl:py-4 py-3 text-center border-b border-b-gray-400">Part Number</th>
                  <th class="px-2 2xl:py-4 py-3 text-center border-b border-b-gray-400">Part Name</th>
                  <th class="px-2 2xl:py-4 py-3 text-center border-b border-b-gray-400">QTY Confirm</th>
                </tr>
              </thead>
              <tbody id="confirm-table-body">
                <!-- Data rows will be inserted here by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Checkbox and Submit Button -->
        <div class="mt-4">
          <label class="flex items-center">
            <input type="checkbox" id="confirm-checkbox" class="mr-2">
            I confirm that the data I provided is correct
          </label>
        </div>
        <div class="flex justify-between items-center mt-4">
          <button id="cancel-button" class="px-4 py-2 text-white bg-red-600 rounded hover:bg-red-700">Cancel</button>
          <button id="submit-button" class="px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700" disabled>Submit</button>
        </div>

      </section>
    </main>
  </section>

<script src="../script.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const noDN = params.get('noDN');

  if (noDN) {
    const dn = deliveryNote.find(dn => dn.noDN === noDN);
    if (dn) {
      displayConfirmDetails(dn.details);
    } else {
      console.error('Data DN tidak ditemukan dalam array data.');
    }
  } else {
    console.error('Parameter noDN tidak ditemukan dalam URL.');
  }

  document.getElementById('confirm-checkbox').addEventListener('change', (e) => {
    document.getElementById('submit-button').disabled = !e.target.checked;
  });

  document.getElementById('submit-button').addEventListener('click', () => {
    submitConfirmData(noDN);
  });

  document.getElementById('cancel-button').addEventListener('click', () => {
    window.location.href = `delivery-note.html?noDN=${noDN}`;
  });
});

function displayConfirmDetails(details) {
  const tableBody = document.getElementById('confirm-table-body');
  tableBody.innerHTML = '';

  details.forEach((row, index) => {
    const tableRow = document.createElement('tr');
    tableRow.classList.add('odd:bg-white', 'even:bg-gray-50', 'border-b', 'dark:border-gray-100');
    tableRow.innerHTML = `
      <td class="px-2 py-4 text-center font-medium text-gray-900">${row.no}</td>
      <td class="px-2 py-4 text-center">${row.partNumber}</td>
      <td class="px-2 py-4 text-center">${row.partName}</td>
      <td class="px-2 py-4 text-center">
        <input type="number" value="${row.qtyConfirm}" class="border border-gray-300 rounded px-2 py-1 text-center">
      </td>
    `;
    tableBody.appendChild(tableRow);
  });
}

function submitConfirmData(noDN) {
  const updatedDetails = [];
  document.querySelectorAll('#confirm-table-body tr').forEach(row => {
    const no = row.cells[0].textContent;
    const partNumber = row.cells[1].textContent;
    const partName = row.cells[2].textContent;
    const qtyConfirm = row.querySelector('input').value;

    updatedDetails.push({ no, partNumber, partName, qtyConfirm });
  });

  const dnIndex = deliveryNote.findIndex(dn => dn.noDN === noDN);
  if (dnIndex !== -1) {
    deliveryNote[dnIndex].details = updatedDetails;
  }

  // Redirect to the main page after submission
  window.location.href = 'delivery-note.html';
}
</script>
</body>
</html>
